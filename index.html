<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Â≠ñÂØ∂Â≠∏Â≠óË©û - 5Ê≠≤Â∞èÊúãÂèã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Comic Sans MS", "Microsoft JhengHei", sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #fff;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .menu {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            padding: 20px 40px;
            font-size: 1.5em;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
        }
        
        .btn-flashcards { background: #FF6B6B; color: white; }
        .btn-quiz { background: #4ECDC4; color: white; }
        .btn-matching { background: #FFE66D; color: #333; }
        .btn-add { background: #95E1D3; color: #333; }
        
        .game-area {
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }
        
        .game-area.active {
            display: block;
        }
        
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
        }
        
        .card {
            width: 150px;
            height: 180px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .card-front {
            background: linear-gradient(145deg, #FF9A9E, #FECFEF);
            font-size: 4em;
        }
        
        .card-back {
            background: linear-gradient(145deg, #A8EDEA, #FED6E3);
            font-size: 2em;
            color: #333;
        }
        
        .card-image { font-size: 4em; }
        .card-text { font-size: 1.8em; font-weight: bold; }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 15px;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .back-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            cursor: pointer;
            margin: 5px;
        }
        
        .emoji { font-size: 3em; }
        .score { font-size: 1.5em; text-align: center; margin: 20px 0; }
        
        .encourage {
            font-size: 2em;
            text-align: center;
            color: #667eea;
            margin: 20px 0;
        }
        
        .options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .option-btn {
            padding: 20px 30px;
            font-size: 1.5em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background: #f0f0f0;
        }
        
        .option-btn.correct { background: #4ECDC4 !important; color: white; }
        .option-btn.wrong { background: #FF6B6B !important; color: white; }
        
        .category-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            background: #f0f0f0;
        }
        
        .category-tab.active { background: #667eea; color: white; }
        
        .matching-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .matching-card {
            aspect-ratio: 1;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .matching-card:hover { transform: scale(1.05); }
        .matching-card.selected { border: 3px solid #667eea; }
        .matching-card.matched { opacity: 0; pointer-events: none; }
        
        .add-word-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .add-word-form input {
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
        
        .add-word-form button {
            padding: 15px;
            font-size: 1.3em;
            border: none;
            border-radius: 10px;
            background: #4ECDC4;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Â≠ñÂØ∂Â≠∏Â≠óË©û</h1>
        
        <div class="menu">
            <button class="menu-btn btn-flashcards" onclick="showGame('flashcards')">üÉè Ë™çÂ≠óÂç°</button>
            <button class="menu-btn btn-quiz" onclick="showGame('quiz')">‚ùì ‰º∞‰º∞Âêì</button>
            <button class="menu-btn btn-matching" onclick="showGame('matching')">üîó ÈÖçÂ∞ç</button>
            <button class="menu-btn btn-add" onclick="showGame('add')">‚ûï Âä†Â≠óË©û</button>
        </div>
        
        <!-- Flashcards -->
        <div id="flashcards" class="game-area">
            <h2 style="text-align: center; color: #667eea;">üÉè Ë™çÂ≠óÂç°</h2>
            <div class="category-tabs" id="fc-tabs"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="fc-progress" style="width: 0%">0/0</div>
            </div>
            <div class="card-container" id="fc-container"></div>
            <div style="text-align: center;">
                <button class="back-btn" onclick="prevCard()">‚¨ÖÔ∏è</button>
                <button class="back-btn" onclick="nextCard()">‚û°Ô∏è</button>
            </div>
        </div>
        
        <!-- Quiz -->
        <div id="quiz" class="game-area">
            <h2 style="text-align: center; color: #4ECDC4;">‚ùì ‰º∞‰º∞ÂêìÈÇäÂÄãÂï±Ôºü</h2>
            <div class="category-tabs" id="quiz-tabs"></div>
            <div class="score" id="quiz-score">‚≠ê 0</div>
            <div id="quiz-question" style="text-align: center; margin: 30px 0;">
                <div class="emoji" id="quiz-emoji">üçé</div>
                <div style="font-size: 1.5em; color: #667eea; margin-top: 15px;">Âë¢ÂÄã‰øÇÂí©Â≠óÔºü</div>
            </div>
            <div class="options" id="quiz-options"></div>
            <div class="encourage" id="quiz-encourage"></div>
        </div>
        
        <!-- Matching -->
        <div id="matching" class="game-area">
            <h2 style="text-align: center; color: #FFE66D;">üîó ÂúñÊñáÈÖçÂ∞ç</h2>
            <div class="category-tabs" id="match-tabs"></div>
            <div class="score" id="match-score">‚≠ê 0</div>
            <div class="matching-grid" id="match-grid"></div>
        </div>
        
        <!-- Add Word -->
        <div id="add" class="game-area">
            <h2 style="text-align: center; color: #95E1D3;">‚ûï Âä†Â≠óË©û</h2>
            <div class="add-word-form">
                <input type="text" id="add-category" placeholder="È°ûÂà• (‰æãÂ¶ÇÔºöÂãïÁâ©„ÄÅÊ∞¥Êûú)">
                <input type="text" id="add-word" placeholder="‰∏≠ÊñáÂ≠óË©û">
                <input type="text" id="add-emoji" placeholder="Emoji (‰æãÂ¶ÇÔºöüçé)">
                <input type="text" id="add-english" placeholder="Ëã±Êñá (‰æãÂ¶ÇÔºöApple)">
                <button onclick="addWord()">‚úÖ Âä†ÂÖ•</button>
            </div>
            <div id="add-result" style="text-align: center; margin-top: 20px; font-size: 1.3em;"></div>
        </div>
    </div>
    
    <script>
        let vocabulary = {
            'üçé Ê∞¥Êûú': [
                { chinese: 'ËòãÊûú', emoji: 'üçé', english: 'Apple' },
                { chinese: 'È¶ôËïâ', emoji: 'üçå', english: 'Banana' },
                { chinese: 'Ê©ô', emoji: 'üçä', english: 'Orange' },
                { chinese: 'Ëë°ËêÑ', emoji: 'üçá', english: 'Grape' },
                { chinese: 'Ë•øÁìú', emoji: 'üçâ', english: 'Watermelon' }
            ],
            'üê± ÂãïÁâ©': [
                { chinese: 'Ë≤ì', emoji: 'üê±', english: 'Cat' },
                { chinese: 'Áãó', emoji: 'üê∂', english: 'Dog' },
                { chinese: 'ÂÖî', emoji: 'üê∞', english: 'Rabbit' },
                { chinese: 'ÁÜäË≤ì', emoji: 'üêº', english: 'Panda' },
                { chinese: 'ËÄÅËôé', emoji: 'üêØ', english: 'Tiger' }
            ],
            'üî¢ Êï∏Â≠ó': [
                { chinese: '‰∏Ä', emoji: '1Ô∏è‚É£', english: 'One' },
                { chinese: '‰∫å', emoji: '2Ô∏è‚É£', english: 'Two' },
                { chinese: '‰∏â', emoji: '3Ô∏è‚É£', english: 'Three' }
            ],
            'üìö Â≠∏‰∏≠Êñá': [
                // (‰∏Ä) ÈªòÁîüÂ≠ó - Basic Characters (13)
                { chinese: 'Êó•', emoji: '‚òÄÔ∏è', english: 'Sun/Day' },
                { chinese: '‰∏ä', emoji: '‚¨ÜÔ∏è', english: 'Up' },
                { chinese: '‰∏ã', emoji: '‚¨áÔ∏è', english: 'Down' },
                { chinese: 'Âè£', emoji: 'üëÑ', english: 'Mouth' },
                { chinese: '‰∏≠', emoji: '‚≠ï', english: 'Middle' },
                { chinese: 'Â∞è', emoji: 'üîπ', english: 'Small' },
                { chinese: '‰∫∫', emoji: 'üë§', english: 'Person' },
                { chinese: 'Â§ß', emoji: 'üî∂', english: 'Big' },
                { chinese: 'Â§©', emoji: 'üå§Ô∏è', english: 'Sky/Day' },
                { chinese: 'ÁôΩ', emoji: '‚¨ú', english: 'White' },
                { chinese: 'Êúà', emoji: 'üåô', english: 'Moon/Month' },
                { chinese: 'Êú®', emoji: 'üå≥', english: 'Wood/Tree' },
                { chinese: 'Â±±', emoji: '‚õ∞Ô∏è', english: 'Mountain' },
                
                // (‰∫å) Ë™çËÆÄÁîüÂ≠ó - Characters (19)
                { chinese: 'ÊÑõ', emoji: '‚ù§Ô∏è', english: 'Love' },
                { chinese: 'Áà∏', emoji: 'üë®', english: 'Dad' },
                { chinese: 'ÈñÄ', emoji: 'üö™', english: 'Door' },
                { chinese: 'Â©Ü', emoji: 'üëµ', english: 'Grandma' },
                { chinese: 'Â™Ω', emoji: 'üë©', english: 'Mom' },
                { chinese: 'Âì•', emoji: 'üë¶', english: 'Brother' },
                { chinese: 'Âßê', emoji: 'üëß', english: 'Sister' },
                { chinese: 'Âºü', emoji: 'üë∂', english: 'Younger Brother' },
                { chinese: 'Áà∫', emoji: 'üë¥', english: 'Grandpa' },
                { chinese: 'Â´≤', emoji: 'üëµ', english: 'Grandma' },
                { chinese: 'Â¶π', emoji: 'üëß', english: 'Younger Sister' },
                { chinese: 'ÂÖ¨', emoji: 'üë¥', english: 'Grandpa' },
                { chinese: 'ÂÆ∂', emoji: 'üè†', english: 'Home' },
                { chinese: 'Á™ó', emoji: 'ü™ü', english: 'Window' },
                { chinese: 'Ê©ã', emoji: 'üåâ', english: 'Bridge' },
                { chinese: 'Âª∫', emoji: 'üèóÔ∏è', english: 'Build' },
                { chinese: 'Â∫ß', emoji: 'ü™ë', english: 'Seat' },
                { chinese: 'Èå¢', emoji: 'üí∞', english: 'Money' },
                { chinese: 'Ë≤∑', emoji: 'üõí', english: 'Buy' },
                
                // (‰∏â) Ë™çËÆÄË©ûË™û - Phrases (42)
                { chinese: 'ÊàøÂ±ã', emoji: 'üè†', english: 'House' },
                { chinese: 'ÈõªÂô®', emoji: 'üîå', english: 'Appliances' },
                { chinese: 'Áî®ÂìÅ', emoji: 'üì¶', english: 'Supplies' },
                { chinese: 'ÂÆ∂ÂÖ∑', emoji: 'ü™ë', english: 'Furniture' },
                { chinese: 'Ê§ÖÂ≠ê', emoji: 'ü™ë', english: 'Chair' },
                { chinese: 'Á©∫Ê∞£', emoji: 'üí®', english: 'Air' },
                { chinese: 'ÊúâÁ¶ÆË≤å', emoji: 'üôá', english: 'Polite' },
                { chinese: 'Èå¢ÁÆ±', emoji: 'üí∞', english: 'Money Box' },
                { chinese: 'Èå¢Âπ£', emoji: 'ü™ô', english: 'Coins' },
                { chinese: 'Ë≥ºÁâ©', emoji: 'üõçÔ∏è', english: 'Shopping' },
                { chinese: 'Âπ´Âä©', emoji: 'ü§ù', english: 'Help' },
                { chinese: 'ÈñãÂøÉ', emoji: 'üòä', english: 'Happy' },
                { chinese: 'È´òÊ®ì', emoji: 'üè¢', english: 'Tall Building' },
                { chinese: 'Â§ßÂªà', emoji: 'üè¢', english: 'Building' },
                { chinese: 'Â§ßÂ§ßÁöÑ', emoji: 'üî∂', english: 'Big' },
                { chinese: 'ÊñπÊñπÁöÑ', emoji: 'üü•', english: 'Square' },
                { chinese: 'ÁæéÈ∫óÁöÑ', emoji: 'üå∏', english: 'Beautiful' },
                { chinese: 'Ê≥•Âúü', emoji: 'üü§', english: 'Soil' },
                { chinese: 'Â†ÖÂõ∫ÁöÑ', emoji: 'üß±', english: 'Strong' },
                { chinese: 'ÁüÆÁüÆÁöÑ', emoji: 'üìè', english: 'Short' },
                { chinese: 'ÁæéÂ•Ω', emoji: 'üåü', english: 'Beautiful' },
                { chinese: 'ÁèçÊÉú', emoji: 'üíé', english: 'Cherish' },
                { chinese: 'ÁîüÂëΩ', emoji: 'üíö', english: 'Life' },
                { chinese: 'Ê∞¥‰ªΩ', emoji: 'üíß', english: 'Water' },
                { chinese: 'Â§¢ÊÉ≥', emoji: 'üí≠', english: 'Dream' },
                { chinese: 'ÊóÖÈÅä', emoji: '‚úàÔ∏è', english: 'Travel' },
                { chinese: 'ÂèãÊÑõ', emoji: 'ü§ù', english: 'Friendship' },
                { chinese: 'Èõ£Âøò', emoji: '‚≠ê', english: 'Unforgettable' },
                { chinese: 'ÈôΩÂÖâ', emoji: '‚òÄÔ∏è', english: 'Sunshine' },
                { chinese: 'ÊúâË∂£', emoji: 'üòÑ', english: 'Fun' },
                { chinese: 'Á®ÆËä±', emoji: 'üå∑', english: 'Plant Flowers' },
                { chinese: 'Áï´Áï´', emoji: 'üé®', english: 'Draw' },
                { chinese: 'Ë∑ëÊ≠•', emoji: 'üèÉ', english: 'Run' },
                { chinese: 'ÊÜ§ÊÄí', emoji: 'üò†', english: 'Angry' },
                { chinese: 'ÈáçË¶Å', emoji: '‚≠ê', english: 'Important' },
                { chinese: 'È©öÊÖå', emoji: 'üò®', english: 'Scared' },
                { chinese: 'Âø´Ê®Ç', emoji: 'üéâ', english: 'Happy' },
                { chinese: 'ÂõûÊÜ∂', emoji: 'üìî', english: 'Memories' },
                { chinese: 'ÊéõÂøµ', emoji: 'üíï', english: 'Miss' },
                { chinese: 'ÊÑüË¨ù', emoji: 'üôè', english: 'Thank' },
                { chinese: 'ÂÅâÂ§ß', emoji: 'üèÜ', english: 'Great' }
            ],
            'üÖ∞Ô∏è Â≠∏Ëã±Êñá': [
                // Recognition of words
                { chinese: '‰∏Ä', emoji: '1Ô∏è‚É£', english: 'one' },
                { chinese: '‰∫å', emoji: '2Ô∏è‚É£', english: 'two' },
                { chinese: '‰∏â', emoji: '3Ô∏è‚É£', english: 'three' },
                { chinese: 'Âõõ', emoji: '4Ô∏è‚É£', english: 'four' },
                { chinese: '‰∫î', emoji: '5Ô∏è‚É£', english: 'five' },
                { chinese: 'ÂÖ≠', emoji: '6Ô∏è‚É£', english: 'six' },
                { chinese: 'Ë≤ì', emoji: 'üê±', english: 'cat' },
                { chinese: 'Áãó', emoji: 'üê∂', english: 'dog' },
                { chinese: 'È≥•', emoji: 'üê¶', english: 'bird' },
                { chinese: 'È≠ö', emoji: 'üêü', english: 'fish' },
                { chinese: 'Ë∑ë', emoji: 'üèÉ', english: 'run' },
                { chinese: 'Ê∏∏Ê∞¥', emoji: 'üèä', english: 'swim' },
                { chinese: 'Ë∑≥', emoji: '‚¨ÜÔ∏è', english: 'jump' },
                { chinese: 'Êàë', emoji: 'üë§', english: 'I' },
                { chinese: 'Êàë', emoji: 'üë§', english: 'am' },
                { chinese: '‰Ω¢', emoji: 'üë§', english: 'it' },
                { chinese: '‰øÇ', emoji: '‚úÖ', english: 'is' },
                { chinese: '‰∏ÄÂÄã', emoji: '1Ô∏è‚É£', english: 'a' },
                { chinese: '‰∏ÄÂÄã', emoji: '2Ô∏è‚É£', english: 'an' },
                { chinese: 'Âë¢ÂÄã', emoji: 'üìç', english: 'the' },
                { chinese: 'Êàë', emoji: 'üë§', english: 'me' },
                { chinese: 'ÊàëÂìã', emoji: 'üë•', english: 'we' },
                { chinese: 'ÂèØ‰ª•', emoji: 'üëç', english: 'can' },
                { chinese: 'Ë¶ãÂà∞', emoji: 'üëÄ', english: 'see' },
                { chinese: 'ÈêòÊÑè', emoji: '‚ù§Ô∏è', english: 'like' },
                // Recognition of pictures and words
                { chinese: '‰∏É', emoji: '7Ô∏è‚É£', english: 'seven' },
                { chinese: 'ÂÖ´', emoji: '8Ô∏è‚É£', english: 'eight' },
                { chinese: '‰πù', emoji: '9Ô∏è‚É£', english: 'nine' },
                { chinese: 'ÂçÅ', emoji: 'üîü', english: 'ten' },
                { chinese: 'Èõ∂', emoji: '0Ô∏è‚É£', english: 'zero' },
                { chinese: 'Áà∏Áà∏', emoji: 'üë®', english: 'father' },
                { chinese: 'Â™ΩÂ™Ω', emoji: 'üë©', english: 'mother' },
                { chinese: 'Âì•Âì•', emoji: 'üë¶', english: 'brother' },
                { chinese: 'ÂßêÂßê', emoji: 'üëß', english: 'sister' },
                { chinese: 'Áà∫Áà∫', emoji: 'üë¥', english: 'grandfather' },
                { chinese: 'Â´≤Â´≤', emoji: 'üëµ', english: 'grandmother' },
                { chinese: 'È´ò', emoji: 'üìè', english: 'tall' },
                { chinese: 'ÁüÆ', emoji: 'üìè', english: 'short' },
                { chinese: 'Âø´', emoji: '‚ö°', english: 'fast' },
                { chinese: 'ÊÖ¢', emoji: 'üê¢', english: 'slow' },
                { chinese: 'ÂÖî', emoji: 'üê∞', english: 'rabbit' },
                { chinese: 'ËúòËõõ', emoji: 'üï∑Ô∏è', english: 'spider' },
                { chinese: 'Ëõá', emoji: 'üêç', english: 'snake' },
                { chinese: 'ÁÉèÈæú', emoji: 'üê¢', english: 'turtle' },
                { chinese: 'ÂÄâÈº†', emoji: 'üêπ', english: 'hamster' },
                { chinese: 'ËÆäËâ≤Èæç', emoji: 'ü¶é', english: 'chameleon' },
                { chinese: 'Ê∏∏Ê∞¥', emoji: 'üèä', english: 'swim' },
                { chinese: 'È£õ', emoji: 'ü™∞', english: 'fly' }
            ]
        };
        
        let currentCategory = 'üçé Ê∞¥Êûú';
        let currentCard = 0;
        let quizScore = 0;
        let matchScore = 0;
        let selectedMatch = null;
        let quizWords = []; // Shuffled quiz words
        let flashcardWords = []; // Shuffled flashcards
        let quizAnswered = 0;
        
        // Audio Context for sound effects
        let audioCtx = null;
        
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playCorrectSound() {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            // Happy ascending notes
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
            osc.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialDecayTo = 0.01;
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.4);
        }
        
        function playWrongSound() {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            // Sad descending notes
            osc.frequency.setValueAtTime(392, audioCtx.currentTime); // G4
            osc.frequency.setValueAtTime(349.23, audioCtx.currentTime + 0.15); // F4
            osc.frequency.setValueAtTime(329.63, audioCtx.currentTime + 0.3); // E4
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.5);
        }
        
        function playWinSound() {
            initAudio();
            const notes = [523.25, 659.25, 783.99, 1046.5]; // C5, E5, G5, C6
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.15);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime + i * 0.15);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.15 + 0.2);
                osc.start(audioCtx.currentTime + i * 0.15);
                osc.stop(audioCtx.currentTime + i * 0.15 + 0.2);
            });
        }
        
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        function showGame(game) {
            document.querySelectorAll('.game-area').forEach(el => el.classList.remove('active'));
            document.getElementById(game).classList.add('active');
            if (game === 'flashcards') initFlashcards();
            if (game === 'quiz') initQuiz();
            if (game === 'matching') initMatching();
        }
        
        function getCategories() { return Object.keys(vocabulary); }
        
        function initFlashcards() {
            // Render tabs
            document.getElementById('fc-tabs').innerHTML = getCategories().map(cat => 
                `<button class="category-tab ${cat === currentCategory ? 'active' : ''}" 
                    onclick="switchCategory('${cat}');">${cat}</button>`
            ).join('');
            // Always shuffle when entering or switching category
            flashcardWords = shuffle([...vocabulary[currentCategory]]);
            currentCard = 0;
            renderCard();
        }
        
        function switchCategory(cat) {
            currentCategory = cat;
            flashcardWords = shuffle([...vocabulary[currentCategory]]);
            currentCard = 0;
            renderCard();
            // Update active tab
            document.querySelectorAll('#fc-tabs .category-tab').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === cat);
            });
        }
        
        function renderCard() {
            const words = flashcardWords.length > 0 ? flashcardWords : shuffle([...vocabulary[currentCategory]]);
            const word = words[currentCard];
            const isEnglish = currentCategory.includes('Â≠∏Ëã±Êñá');
            
            document.getElementById('fc-progress').style.width = ((currentCard + 1) / words.length * 100) + '%';
            document.getElementById('fc-progress').textContent = `${currentCard + 1}/${words.length}`;
            
            if (isEnglish) {
                // English: show emoji + English only
                document.getElementById('fc-container').innerHTML = `
                    <div class="card card-front"><div class="card-image">${word.emoji}</div></div>
                    <div class="card card-back"><div class="card-text">${word.english}</div></div>
                `;
            } else {
                // Chinese: show emoji + Chinese + English
                document.getElementById('fc-container').innerHTML = `
                    <div class="card card-front"><div class="card-image">${word.emoji}</div></div>
                    <div class="card card-back"><div class="card-text">${word.chinese}</div><div style="font-size:0.6em;color:#666;">${word.english}</div></div>
                `;
            }
        }
        
        function prevCard() { 
            const words = flashcardWords.length > 0 ? flashcardWords : vocabulary[currentCategory];
            if (currentCard > 0) { currentCard--; renderCard(); } 
        }
        function nextCard() { 
            const words = flashcardWords.length > 0 ? flashcardWords : vocabulary[currentCategory];
            if (currentCard < words.length - 1) { currentCard++; renderCard(); } 
        }
        
        function initQuiz() {
            // Render tabs
            document.getElementById('quiz-tabs').innerHTML = getCategories().map(cat => 
                `<button class="category-tab ${cat === currentCategory ? 'active' : ''}" 
                    onclick="switchQuizCategory('${cat}');">${cat}</button>`
            ).join('');
            // Shuffle words for quiz
            quizWords = shuffle([...vocabulary[currentCategory]]);
            quizScore = 0;
            quizAnswered = 0;
            document.getElementById('quiz-score').textContent = '‚≠ê 0';
            renderQuiz();
        }
        
        function switchQuizCategory(cat) {
            currentCategory = cat;
            quizWords = shuffle([...vocabulary[currentCategory]]);
            quizScore = 0;
            quizAnswered = 0;
            document.getElementById('quiz-score').textContent = '‚≠ê 0';
            // Update active tab
            document.querySelectorAll('#quiz-tabs .category-tab').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === cat);
            });
            renderQuiz();
        }
        
        function renderQuiz() {
            if (quizWords.length === 0) {
                // Quiz complete!
                document.getElementById('quiz-emoji').textContent = 'üéä';
                document.getElementById('quiz-encourage').textContent = `ÂÆåÊàêÊôíÔºÅÂãÅÂëÄÔºÅ‚≠ê‚≠ê‚≠ê`;
                document.getElementById('quiz-options').innerHTML = '';
                playWinSound();
                setTimeout(() => initQuiz(), 3000); // Restart
                return;
            }
            
            const correct = quizWords.pop();
            let options = [correct];
            const others = vocabulary[currentCategory].filter(w => w !== correct);
            while (options.length < 4 && others.length > 0) {
                const idx = Math.floor(Math.random() * others.length);
                if (!options.includes(others[idx])) options.push(others[idx]);
            }
            options = shuffle(options);
            
            quizAnswered++;

            // Check if English category - show English only
            const isEnglish = currentCategory.includes('Â≠∏Ëã±Êñá');
            
            if (isEnglish) {
                // English quiz: show emoji + English, options are English
                document.getElementById('quiz-emoji').textContent = correct.emoji + ' ' + correct.english;
                document.getElementById('quiz-encourage').textContent = 'ÊèÄÂï±‰Ω¢ÔºÅ';
                document.getElementById('quiz-options').innerHTML = options.map(opt => 
                    `<button class="option-btn" onclick="checkAnswer(this, '${opt.english}', '${correct.english}')">${opt.english}</button>`
                ).join('');
            } else {
                // Chinese quiz: show emoji, options are Chinese
                document.getElementById('quiz-emoji').textContent = correct.emoji;
                document.getElementById('quiz-encourage').textContent = 'Âë¢ÂÄã‰øÇÂí©Â≠óÔºü';
                document.getElementById('quiz-options').innerHTML = options.map(opt => 
                    `<button class="option-btn" onclick="checkAnswer(this, '${opt.chinese}', '${correct.chinese}')">${opt.chinese}</button>`
                ).join('');
            }
        }
        
        function checkAnswer(btn, ans, correct) {
            if (ans === correct) {
                btn.classList.add('correct');
                playCorrectSound();
                quizScore++;
                document.getElementById('quiz-score').textContent = '‚≠ê ' + quizScore;
                const encourages = ['ÂãÅÂëÄÔºÅüéâ', 'ÂèªÂèªÁå™ÔºÅüê∑', 'Â•ΩÂèªÂëÄÔºÅ‚≠ê', 'ÂèªÂà∞Âë¢ÔºÅüëè', 'Ê≠£ÂëÄÔºÅüí™'];
                document.getElementById('quiz-encourage').textContent = encourages[Math.floor(Math.random() * encourages.length)];
                setTimeout(renderQuiz, 1200);
            } else {
                btn.classList.add('wrong');
                playWrongSound();
                const wrongMsg = ['Âä†Ê≤πÂëÄÔºÅüí™', 'ÂÜçË©¶ÂêìÔºÅüòä', 'ÂîîÁ∑äË¶ÅÔºÅü§ó', 'ÁπºÁ∫åÂä™ÂäõÔºÅüåü'];
                document.getElementById('quiz-encourage').textContent = wrongMsg[Math.floor(Math.random() * wrongMsg.length)];
            }
        }
        
        function initMatching() {
            document.getElementById('match-tabs').innerHTML = getCategories().map(cat => 
                `<button class="category-tab ${cat === currentCategory ? 'active' : ''}" onclick="currentCategory='${cat}'; initMatching();">${cat}</button>`
            ).join('');
            const words = vocabulary[currentCategory].slice(0, 4);
            const pairs = [];
            const isEnglish = currentCategory.includes('Â≠∏Ëã±Êñá');
            words.forEach((w, i) => {
                // For English, match emoji with English word
                // For Chinese, match emoji with Chinese character
                const text = isEnglish ? w.english : w.chinese;
                pairs.push({ type: 'emoji', content: w.emoji, id: 'e' + i, matchId: 'c' + i });
                pairs.push({ type: 'text', content: text, id: 'c' + i, matchId: 'e' + i });
            });
            const shuffled = shuffle(pairs);
            document.getElementById('match-score').textContent = '‚≠ê ' + matchScore;
            document.getElementById('match-grid').innerHTML = shuffled.map(p => 
                `<div class="matching-card" style="background:${p.type==='emoji'?'#FFE66D':'#4ECDC4'}" 
                     data-id="${p.id}" data-mid="${p.matchId}" onclick="selectMatch(this)">${p.content}</div>`
            ).join('');
        }
        
        function selectMatch(card) {
            if (card.classList.contains('matched')) return;
            if (!selectedMatch) {
                selectedMatch = card;
                card.classList.add('selected');
            } else {
                if (selectedMatch.dataset.id === card.dataset.id) {
                    selectedMatch.classList.remove('selected');
                    selectedMatch = null;
                } else if (selectedMatch.dataset.mid === card.dataset.id) {
                    card.classList.add('matched');
                    selectedMatch.classList.add('matched');
                    playCorrectSound();
                    matchScore++;
                    document.getElementById('match-score').textContent = '‚≠ê ' + matchScore;
                    selectedMatch = null;
                    
                    // Check if all matched
                    const remaining = document.querySelectorAll('.matching-card:not(.matched)');
                    if (remaining.length === 0) {
                        setTimeout(() => {
                            playWinSound();
                            alert('üéä ÂÆåÊàêÊôíÔºÅÂãÅÂëÄÔºÅ‚≠ê‚≠ê‚≠ê');
                            matchScore = 0;
                            initMatching();
                        }, 500);
                    }
                } else {
                    playWrongSound();
                    selectedMatch.classList.remove('selected');
                    selectedMatch = card;
                    card.classList.add('selected');
                }
            }
        }
        
        function addWord() {
            const cat = document.getElementById('add-category').value.trim();
            const w = document.getElementById('add-word').value.trim();
            const e = document.getElementById('add-emoji').value.trim();
            const en = document.getElementById('add-english').value.trim();
            if (!cat || !w || !e) {
                document.getElementById('add-result').innerHTML = '‚ùå Ë¶ÅÂ°´ÊôíÈ°ûÂà•„ÄÅÊñáÂ≠ó„ÄÅEmojiÔºÅ';
                return;
            }
            if (!vocabulary[cat]) vocabulary[cat] = [];
            vocabulary[cat].push({ chinese: w, emoji: e, english: en });
            document.getElementById('add-result').innerHTML = `‚úÖ Âä†ÂÖ•ÊàêÂäüÔºÅ<br><div style="font-size:2em">${e}</div><div>${w} = ${en}</div>`;
            ['add-category','add-word','add-emoji','add-english'].forEach(id => document.getElementById(id).value = '');
        }
    </script>
</body>
</html>
