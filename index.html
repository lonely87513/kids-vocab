<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® å­–å¯¶å­¸å­—è© - 5æ­²å°æœ‹å‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Comic Sans MS", "Microsoft JhengHei", sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; color: #fff; font-size: 2.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        
        .menu { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px; }
        .menu-btn { padding: 20px 40px; font-size: 1.5em; border: none; border-radius: 20px; cursor: pointer; transition: all 0.3s; box-shadow: 0 6px 0 rgba(0,0,0,0.2); }
        .menu-btn:hover { transform: translateY(-3px); }
        .btn-flashcards { background: #FF6B6B; color: white; }
        .btn-quiz { background: #4ECDC4; color: white; }
        .btn-matching { background: #FFE66D; color: #333; }
        .btn-add { background: #95E1D3; color: #333; }
        
        .game-area { background: white; border-radius: 30px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; }
        .game-area.active { display: block; }
        
        .card-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin: 30px 0; }
        .card { width: 150px; height: 180px; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .card-front { background: linear-gradient(145deg, #FF9A9E, #FECFEF); font-size: 4em; }
        .card-back { background: linear-gradient(145deg, #A8EDEA, #FED6E3); font-size: 2em; color: #333; }
        
        .progress-bar { width: 100%; height: 30px; background: #f0f0f0; border-radius: 15px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 15px; transition: width 0.5s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        
        .back-btn { padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 10px; background: #667eea; color: white; cursor: pointer; margin: 5px; }
        
        .category-tabs { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        .category-tab { padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-size: 1.1em; background: #f0f0f0; }
        .category-tab.active { background: #667eea; color: white; }
        
        .score { font-size: 1.5em; text-align: center; margin: 20px 0; }
        .emoji { font-size: 3em; text-align: center; }
        
        .options { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        .option-btn { padding: 20px 30px; font-size: 1.5em; border: none; border-radius: 15px; cursor: pointer; background: #f0f0f0; transition: all 0.3s; }
        .option-btn:hover { background: #667eea; color: white; }
        .option-btn.correct { background: #4ECDC4 !important; color: white !important; }
        .option-btn.wrong { background: #FF6B6B !important; color: white !important; }
        
        .encourage { font-size: 2em; text-align: center; color: #667eea; margin: 20px 0; }
        
        .matching-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; max-width: 600px; margin: 0 auto; }
        .matching-card { aspect-ratio: 1; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5em; cursor: pointer; transition: all 0.3s; }
        .matching-card:hover { transform: scale(1.05); }
        .matching-card.selected { border: 3px solid #667eea; }
        .matching-card.matched { opacity: 0; pointer-events: none; }
        
        .add-word-form { display: flex; flex-direction: column; gap: 15px; max-width: 400px; margin: 0 auto; }
        .add-word-form input { padding: 15px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 10px; }
        .add-word-form button { padding: 15px; font-size: 1.3em; border: none; border-radius: 10px; background: #4ECDC4; color: white; cursor: pointer; }
        
        .speak-btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 35px; 
            height: 35px; 
            font-size: 1em; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            margin-left: 8px;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        .speak-btn:hover { transform: scale(1.1); background: #764ba2; }
        .card-back { 
            text-align: center; 
            padding: 10px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 5px;
        }
        .word-row { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .word-text { font-size: 1.5em; font-weight: bold; }
        .word-english { font-size: 0.8em; color: #666; }
        .quiz-speak-btn {
            padding: 10px 20px;
            font-size: 1.2em;
            border: none;
            border-radius: 15px;
            background: #FFE66D;
            color: #333;
            cursor: pointer;
            margin-top: 15px;
        }
        .quiz-speak-btn:hover { background: #FFD93D; }
        
        /* Quantity Slider */
        .quantity-control {
            background: #f8f8f8;
            border-radius: 15px;
            padding: 15px 20px;
            margin: 15px auto;
            max-width: 400px;
        }
        .quantity-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #667eea;
        }
        .quantity-slider {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            outline: none;
            -webkit-appearance: none;
        }
        .quantity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .quantity-slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .card { position: relative; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® å­–å¯¶å­¸å­—è©</h1>
        
        <div class="menu">
            <button class="menu-btn btn-flashcards" onclick="showGame('flashcards')">ğŸƒ èªå­—å¡</button>
            <button class="menu-btn btn-quiz" onclick="showGame('quiz')">â“ ä¼°ä¼°å“</button>
            <button class="menu-btn btn-matching" onclick="showGame('matching')">ğŸ”— é…å°</button>
            <button class="menu-btn btn-add" onclick="showGame('add')">â• åŠ å­—è©</button>
        </div>
        
        <!-- Flashcards -->
        <div id="flashcards" class="game-area">
            <h2 style="text-align: center; color: #667eea;">ğŸƒ èªå­—å¡</h2>
            <div class="category-tabs" id="fc-tabs"></div>
            
            <!-- Quantity Slider for K2ç¬¬äºŒæ®µä¸­æ–‡ & K2ç¬¬äºŒæ®µè‹±æ–‡ -->
            <div id="fc-quantity-control" class="quantity-control" style="display:none;">
                <div class="quantity-label">
                    <span>ğŸ“Š ç‡å¹¾å¤šé¡Œï¼Ÿ</span>
                    <span id="fc-quantity-display">10 é¡Œ</span>
                </div>
                <input type="range" id="fc-quantity-slider" class="quantity-slider" min="1" max="100" value="10" onchange="updateFcQuantity(this.value)">
                <div style="text-align:center;margin-top:15px;">
                    <button class="back-btn" onclick="startFlashcards()">âœ… é–‹å§‹ ğŸƒ</button>
                </div>
            </div>
            
            <div style="text-align: center; margin: 15px 0;">
                <button id="emoji-toggle" onclick="toggleEmoji()" style="padding: 10px 20px; font-size: 1em; border: none; border-radius: 10px; cursor: pointer; background: #FFE66D; color: #333;">ğŸ‘ï¸ éš±è— Emoji</button>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="fc-progress" style="width: 0%">0/0</div></div>
            <div class="card-container" id="fc-container"></div>
            <div style="text-align: center;">
                <button class="back-btn" onclick="prevCard()">â¬…ï¸</button>
                <button class="back-btn" onclick="nextCard()">â¡ï¸</button>
            </div>
        </div>
        
        <!-- Quiz -->
        <div id="quiz" class="game-area">
            <h2 style="text-align: center; color: #4ECDC4;">â“ ä¼°ä¼°å“é‚Šå€‹å•±ï¼Ÿ</h2>
            <div class="category-tabs" id="quiz-tabs"></div>
            
            <!-- Quantity Slider for K2ç¬¬äºŒæ®µä¸­æ–‡ & K2ç¬¬äºŒæ®µè‹±æ–‡ -->
            <div id="quantity-control" class="quantity-control" style="display:none;">
                <div class="quantity-label">
                    <span>ğŸ“Š é¡Œç›®æ•¸é‡</span>
                    <span id="quantity-display">10 é¡Œ</span>
                </div>
                <input type="range" id="quantity-slider" class="quantity-slider" min="1" max="20" value="10" onchange="updateQuantity(this.value)">
            </div>
            
            <div class="score" id="quiz-score">â­ 0</div>
            <div style="text-align: center; margin: 30px 0;">
                <div class="emoji" id="quiz-emoji">ğŸ</div>
                <div id="quiz-prompt" style="font-size: 1.5em; color: #667eea; margin-top: 15px;">å‘¢å€‹ä¿‚å’©å­—ï¼Ÿ</div>
            </div>
            <div class="options" id="quiz-options"></div>
            <div class="encourage" id="quiz-encourage"></div>
        </div>
        
        <!-- Matching -->
        <div id="matching" class="game-area">
            <h2 style="text-align: center; color: #FFE66D;">ğŸ”— åœ–æ–‡é…å°</h2>
            <div class="category-tabs" id="match-tabs"></div>
            <div class="score" id="match-score">â­ 0</div>
            <div class="matching-grid" id="match-grid"></div>
        </div>
        
        <!-- Add Word -->
        <div id="add" class="game-area">
            <h2 style="text-align: center; color: #95E1D3;">â• åŠ å­—è©</h2>
            <div class="add-word-form">
                <input type="text" id="add-category" placeholder="é¡åˆ¥ (ä¾‹å¦‚ï¼šK2ç¬¬äºŒæ®µä¸­æ–‡)">
                <input type="text" id="add-word" placeholder="ä¸­æ–‡å­—è©">
                <input type="text" id="add-emoji" placeholder="Emoji (ä¾‹å¦‚ï¼šğŸ)">
                <input type="text" id="add-english" placeholder="è‹±æ–‡ (ä¾‹å¦‚ï¼šApple)">
                <button onclick="addWord()">âœ… åŠ å…¥</button>
            </div>
            <div id="add-result" style="text-align: center; margin-top: 20px; font-size: 1.3em;"></div>
        </div>
    </div>
    
    <script>
        // Load voices early
        window.speechSynthesis.onvoiceschanged = function() {
            window.speechSynthesis.getVoices();
        };
        
        // Vocabulary data
        const vocabulary = {
            'ğŸ“š K2ç¬¬äºŒæ®µä¸­æ–‡': [
                { chinese: 'æ—¥', emoji: 'â˜€ï¸', english: 'Sun/Day' },
                { chinese: 'ä¸Š', emoji: 'â¬†ï¸', english: 'Up' },
                { chinese: 'ä¸‹', emoji: 'â¬‡ï¸', english: 'Down' },
                { chinese: 'äºº', emoji: 'ğŸ‘¤', english: 'Person' },
                { chinese: 'å¤§', emoji: 'ğŸ”¶', english: 'Big' },
                { chinese: 'å°', emoji: 'ğŸ”¹', english: 'Small' },
                { chinese: 'å¤©', emoji: 'ğŸŒ¤ï¸', english: 'Sky/Day' },
                { chinese: 'å±±', emoji: 'â›°ï¸', english: 'Mountain' },
                { chinese: 'æ„›', emoji: 'â¤ï¸', english: 'Love' },
                { chinese: 'çˆ¸', emoji: 'ğŸ‘¨', english: 'Dad' },
                { chinese: 'åª½', emoji: 'ğŸ‘©', english: 'Mom' },
                { chinese: 'å®¶', emoji: 'ğŸ ', english: 'Home' },
                { chinese: 'é–€', emoji: 'ğŸšª', english: 'Door' },
                { chinese: 'çª—', emoji: 'ğŸªŸ', english: 'Window' },
                { chinese: 'éŒ¢', emoji: 'ğŸ’°', english: 'Money' },
                { chinese: 'é–‹å¿ƒ', emoji: 'ğŸ˜Š', english: 'Happy' },
                { chinese: 'å¹«åŠ©', emoji: 'ğŸ¤', english: 'Help' },
                { chinese: 'å¿«æ¨‚', emoji: 'ğŸ‰', english: 'Happy' },
                { chinese: 'æ„Ÿè¬', emoji: 'ğŸ™', english: 'Thank' },
                { chinese: 'é«˜æ¨“', emoji: 'ğŸ¢', english: 'Building' },
                { chinese: 'æ—…éŠ', emoji: 'âœˆï¸', english: 'Travel' },
                { chinese: 'ç•«ç•«', emoji: 'ğŸ¨', english: 'Draw' },
                { chinese: 'å©†', emoji: 'ğŸ‘µ', english: 'Grandma' },
                { chinese: 'å“¥', emoji: 'ğŸ‘¦', english: 'Brother' },
                { chinese: 'å§', emoji: 'ğŸ‘§', english: 'Sister' },
                { chinese: 'å¼Ÿ', emoji: 'ğŸ‘¶', english: 'Baby brother' },
                { chinese: 'çˆº', emoji: 'ğŸ‘´', english: 'Grandpa' },
                { chinese: 'å«²', emoji: 'ğŸ§“', english: 'Grandmother' },
                { chinese: 'å¦¹', emoji: 'ğŸ‘©â€ğŸ¦°', english: 'Younger sister' },
                { chinese: 'å…¬', emoji: 'ğŸ‘´', english: 'Grandpa' },
                { chinese: 'æ©‹', emoji: 'ğŸŒ‰', english: 'Bridge' },
                { chinese: 'å»º', emoji: 'ğŸ—ï¸', english: 'Build' },
                { chinese: 'åº§', emoji: 'ğŸ’º', english: 'Seat' },
                { chinese: 'è²·', emoji: 'ğŸ›’', english: 'Buy' },
                { chinese: 'æˆ¿å±‹', emoji: 'ğŸ ', english: 'House' },
                { chinese: 'é›»å™¨', emoji: 'ğŸ”Œ', english: 'Electrical' },
                { chinese: 'ç”¨å“', emoji: 'ğŸ›ï¸', english: 'Supplies' },
                { chinese: 'å®¶å…·', emoji: 'ğŸª‘', english: 'Furniture' },
                { chinese: 'æ¤…å­', emoji: 'ğŸª‘', english: 'Chair' },
                { chinese: 'ç©ºæ°£', emoji: 'ğŸ’¨', english: 'Air' },
                { chinese: 'æœ‰ç¦®è²Œ', emoji: 'ğŸ™‡', english: 'Polite' },
                { chinese: 'éŒ¢ç®±', emoji: 'ğŸ’°', english: 'Money box' },
                { chinese: 'éŒ¢å¹£', emoji: 'ğŸª™', english: 'Coin' },
                { chinese: 'è³¼ç‰©', emoji: 'ğŸ›’', english: 'Shopping' },
                { chinese: 'é«˜æ¨“', emoji: 'ğŸ¢', english: 'Tall building' },
                { chinese: 'å¤§å»ˆ', emoji: 'ğŸ¬', english: 'Building' },
                { chinese: 'å¤§å¤§çš„', emoji: 'ğŸ”´', english: 'Big' },
                { chinese: 'æ–¹æ–¹çš„', emoji: 'ğŸŸ¦', english: 'Square' },
                { chinese: 'ç¾éº—çš„', emoji: 'ğŸŒ¸', english: 'Beautiful' },
                { chinese: 'æ³¥åœŸ', emoji: 'ğŸª¨', english: 'Soil' },
                { chinese: 'å …å›ºçš„', emoji: 'ğŸ’ª', english: 'Strong' },
                { chinese: 'çŸ®çŸ®çš„', emoji: 'ğŸ”½', english: 'Short' },
                { chinese: 'ç¾å¥½', emoji: 'âœ¨', english: 'Wonderful' },
                { chinese: 'çæƒœ', emoji: 'ğŸ’', english: 'Cherish' },
                { chinese: 'ç”Ÿå‘½', emoji: 'â¤ï¸', english: 'Life' },
                { chinese: 'æ°´ä»½', emoji: 'ğŸ’§', english: 'Water' },
                { chinese: 'å¤¢æƒ³', emoji: 'ğŸŒŸ', english: 'Dream' },
                { chinese: 'å‹æ„›', emoji: 'ğŸ¤—', english: 'Friendship' },
                { chinese: 'é›£å¿˜', emoji: 'ğŸ“', english: 'Unforgettable' },
                { chinese: 'é™½å…‰', emoji: 'â˜€ï¸', english: 'Sunshine' },
                { chinese: 'æœ‰è¶£', emoji: 'ğŸ˜„', english: 'Interesting' },
                { chinese: 'ç¨®èŠ±', emoji: 'ğŸŒº', english: 'Plant flowers' },
                { chinese: 'è·‘æ­¥', emoji: 'ğŸƒ', english: 'Run' },
                { chinese: 'æ†¤æ€’', emoji: 'ğŸ˜ ', english: 'Angry' },
                { chinese: 'é‡è¦', emoji: 'â­', english: 'Important' },
                { chinese: 'é©šæ…Œ', emoji: 'ğŸ˜¨', english: 'Panic' },
                { chinese: 'å›æ†¶', emoji: 'ğŸ“¸', english: 'Memory' },
                { chinese: 'æ›å¿µ', emoji: 'ğŸ’­', english: 'Miss' },
                { chinese: 'å‰å¤§', emoji: 'ğŸŒŸ', english: 'Great' },
                { chinese: 'é«˜', emoji: 'â¬†ï¸', english: 'High' },
                { chinese: 'çŸ®', emoji: 'â¬‡ï¸', english: 'Short' },
                { chinese: 'è¼•', emoji: 'ğŸª¶', english: 'Light' },
                { chinese: 'é‡', emoji: 'âš–ï¸', english: 'Heavy' },
                { chinese: 'é•·', emoji: 'ğŸ“', english: 'Long' },
                { chinese: 'çŸ­', emoji: 'ğŸ“', english: 'Short' },
                { chinese: 'è»Ÿ', emoji: 'ğŸ§¸', english: 'Soft' },
                { chinese: 'ç¡¬', emoji: 'ğŸ’', english: 'Hard' },
                { chinese: 'æ–°', emoji: 'ğŸ†•', english: 'New' },
                { chinese: 'èˆŠ', emoji: 'ğŸ—‘ï¸', english: 'Old' }
            ],
            'ğŸ…°ï¸ K2ç¬¬äºŒæ®µè‹±æ–‡': [
                { chinese: 'ä¸€', emoji: '1ï¸âƒ£', english: 'one' },
                { chinese: 'äºŒ', emoji: '2ï¸âƒ£', english: 'two' },
                { chinese: 'ä¸‰', emoji: '3ï¸âƒ£', english: 'three' },
                { chinese: 'å››', emoji: '4ï¸âƒ£', english: 'four' },
                { chinese: 'äº”', emoji: '5ï¸âƒ£', english: 'five' },
                { chinese: 'å…­', emoji: '6ï¸âƒ£', english: 'six' },
                { chinese: 'ä¸ƒ', emoji: '7ï¸âƒ£', english: 'seven' },
                { chinese: 'å…«', emoji: '8ï¸âƒ£', english: 'eight' },
                { chinese: 'ä¹', emoji: '9ï¸âƒ£', english: 'nine' },
                { chinese: 'å', emoji: 'ğŸ”Ÿ', english: 'ten' },
                { chinese: 'è²“', emoji: 'ğŸ±', english: 'cat' },
                { chinese: 'ç‹—', emoji: 'ğŸ¶', english: 'dog' },
                { chinese: 'é³¥', emoji: 'ğŸ¦', english: 'bird' },
                { chinese: 'é­š', emoji: 'ğŸŸ', english: 'fish' },
                { chinese: 'å…”', emoji: 'ğŸ°', english: 'rabbit' },
                { chinese: 'çˆ¸çˆ¸', emoji: 'ğŸ‘¨', english: 'father' },
                { chinese: 'åª½åª½', emoji: 'ğŸ‘©', english: 'mother' },
                { chinese: 'è·‘', emoji: 'ğŸƒ', english: 'run' },
                { chinese: 'æ¸¸æ°´', emoji: 'ğŸŠ', english: 'swim' },
                { chinese: 'é£›', emoji: 'âœˆï¸', english: 'fly' }
            ]
        };
        
        // Game state
        let currentCategory = 'ğŸ“š K2ç¬¬äºŒæ®µä¸­æ–‡';
        let currentCard = 0;
        let quizScore = 0;
        let matchScore = 0;
        let quizWords = [];
        let flashcardWords = [];
        let selectedMatch = null;
        let showEmoji = true;
        let quizQuantity = 10; // Default 10 questions
        let fcQuantity = 10; // Flashcards quantity
        
        // Shuffle function
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        // Show game
        function showGame(game) {
            document.querySelectorAll('.game-area').forEach(el => el.classList.remove('active'));
            document.getElementById(game).classList.add('active');
            if (game === 'flashcards') initFlashcards();
            if (game === 'quiz') initQuiz();
            if (game === 'matching') initMatching();
        }
        
        function getCategories() { return Object.keys(vocabulary); }
        
        // Flashcards
        function initFlashcards() {
            document.getElementById('fc-tabs').innerHTML = getCategories().map(cat => 
                `<button class="category-tab ${cat === currentCategory ? 'active' : ''}" onclick="switchCategory('${cat}')">${cat}</button>`
            ).join('');
            
            // Check if showing quantity control
            const isLearningCategory = currentCategory.includes('K2ç¬¬äºŒæ®µä¸­æ–‡') || currentCategory.includes('K2ç¬¬äºŒæ®µè‹±æ–‡');
            document.getElementById('fc-quantity-control').style.display = isLearningCategory ? 'block' : 'none';
            
            // Show quantity slider only for learning categories
            if (isLearningCategory) {
                const availableWords = vocabulary[currentCategory].length;
                const slider = document.getElementById('fc-quantity-slider');
                slider.max = Math.min(100, availableWords);
                if (fcQuantity > availableWords) fcQuantity = availableWords;
                slider.value = fcQuantity;
                document.getElementById('fc-quantity-display').textContent = `${fcQuantity} é¡Œ / å…± ${availableWords} é¡Œ`;
                
                // Hide cards and progress when quantity selector is shown
                document.getElementById('fc-container').innerHTML = '<div style="text-align:center;color:#667eea;font-size:1.5em;padding:50px;">ğŸ‘‡ è¨­å®šé¡Œç›®æ•¸é‡å¾ŒæŒ‰ã€Œé–‹å§‹ã€ğŸƒ</div>';
                document.getElementById('fc-progress').style.width = '0%';
                document.getElementById('fc-progress').textContent = '0/0';
            } else {
                // For other categories, show all cards
                fcQuantity = vocabulary[currentCategory].length;
                flashcardWords = shuffle([...vocabulary[currentCategory]]);
                currentCard = 0;
                renderCard();
            }
        }
        
        // Update flashcards quantity
        function updateFcQuantity(value) {
            fcQuantity = parseInt(value);
            const availableWords = vocabulary[currentCategory].length;
            document.getElementById('fc-quantity-display').textContent = `${fcQuantity} é¡Œ / å…± ${availableWords} é¡Œ`;
        }
        
        // Start flashcards with selected quantity
        function startFlashcards() {
            const allWords = shuffle([...vocabulary[currentCategory]]);
            flashcardWords = allWords.slice(0, fcQuantity);
            currentCard = 0;
            renderCard();
        }
        
        function switchCategory(cat) {
            currentCategory = cat;
            fcQuantity = 10; // Reset to default
            document.getElementById('fc-quantity-slider').value = 10;
            initFlashcards();
        }
        
        function toggleEmoji() {
            showEmoji = !showEmoji;
            document.getElementById('emoji-toggle').innerHTML = showEmoji ? 'ğŸ‘ï¸ éš±è— Emoji' : 'ğŸ‘ï¸ é¡¯ç¤º Emoji';
            document.getElementById('emoji-toggle').style.background = showEmoji ? '#FFE66D' : '#ddd';
            renderCard();
        }
        
        function renderCard() {
            const word = flashcardWords[currentCard];
            const isEnglish = currentCategory.includes('K2ç¬¬äºŒæ®µè‹±æ–‡');
            const isChineseLearning = currentCategory.includes('K2ç¬¬äºŒæ®µä¸­æ–‡');
            document.getElementById('fc-progress').style.width = ((currentCard + 1) / flashcardWords.length * 100) + '%';
            document.getElementById('fc-progress').textContent = `${currentCard + 1}/${flashcardWords.length}`;
            
            // Smaller emoji for learning categories to avoid blocking buttons
            const emojiSize = (isEnglish || isChineseLearning) ? '1.2em' : '4em';
            
            if (isEnglish) {
                document.getElementById('fc-container').innerHTML = `
                    <div class="card card-front"><div style="font-size:${emojiSize}">${showEmoji ? word.emoji : ""}</div></div>
                    <div class="card card-back">
                        <div class="word-row">
                            <span class="word-text">${word.english}</span>
                            <button class="speak-btn" onclick="speakText('${word.english}', 'en')">ğŸ”Š</button>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('fc-container').innerHTML = `
                    <div class="card card-front"><div style="font-size:${emojiSize}">${showEmoji ? word.emoji : ""}</div></div>
                    <div class="card card-back">
                        <div class="word-row">
                            <span class="word-text">${word.chinese}</span>
                            <button class="speak-btn" onclick="speakText('${word.chinese}', 'zh-HK')">ğŸ”Š</button>
                        </div>
                        <div class="word-english">${word.english}</div>
                    </div>
                `;
            }
        }
        
        // Speak text function
        function speakText(text, lang) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.8; // Slower for kids
                utterance.pitch = 1.1; // Slightly higher pitch for friendliness
                
                // Try to find a Cantonese voice for zh-HK
                const voices = window.speechSynthesis.getVoices();
                if (lang === 'zh-HK') {
                    const cantoneseVoice = voices.find(v => v.lang.includes('zh-HK') || v.lang.includes('yue') || v.lang.includes('zh-CN'));
                    if (cantoneseVoice) utterance.voice = cantoneseVoice;
                }
                
                window.speechSynthesis.speak(utterance);
            } else {
                alert('å‘¢éƒ¨æ©Ÿæœªæ”¯æ´èªéŸ³åŠŸèƒ½ ğŸ¤·');
            }
        }
        
        function prevCard() { if (currentCard > 0) { currentCard--; renderCard(); } }
        function nextCard() { if (currentCard < flashcardWords.length - 1) { currentCard++; renderCard(); } }
        
        // Quiz
        function initQuiz() {
            // Show/hide quantity slider based on category
            const isLearningCategory = currentCategory.includes('K2ç¬¬äºŒæ®µä¸­æ–‡') || currentCategory.includes('K2ç¬¬äºŒæ®µè‹±æ–‡');
            document.getElementById('quantity-control').style.display = isLearningCategory ? 'block' : 'none';
            
            // Update slider max based on available words
            const availableWords = vocabulary[currentCategory].length;
            const slider = document.getElementById('quantity-slider');
            slider.max = Math.min(20, availableWords);
            if (quizQuantity > availableWords) {
                quizQuantity = availableWords;
                slider.value = quizQuantity;
            }
            document.getElementById('quantity-display').textContent = `${quizQuantity} é¡Œ / å…± ${availableWords} é¡Œ`;
            
            document.getElementById('quiz-tabs').innerHTML = getCategories().map(cat => 
                `<button class="category-tab ${cat === currentCategory ? 'active' : ''}" onclick="switchQuizCategory('${cat}')">${cat}</button>`
            ).join('');
            
            // Use quantity limit
            const allWords = shuffle([...vocabulary[currentCategory]]);
            quizWords = allWords.slice(0, quizQuantity);
            quizScore = 0;
            document.getElementById('quiz-score').textContent = `â­ 0 / ${quizQuantity}`;
            renderQuiz();
        }
        
        // Update quantity from slider
        function updateQuantity(value) {
            quizQuantity = parseInt(value);
            const availableWords = vocabulary[currentCategory].length;
            document.getElementById('quantity-display').textContent = `${quizQuantity} é¡Œ / å…± ${availableWords} é¡Œ`;
        }
        
        function switchQuizCategory(cat) {
            currentCategory = cat;
            
            // Reset quantity to default
            quizQuantity = 10;
            document.getElementById('quantity-slider').value = 10;
            
            const allWords = shuffle([...vocabulary[currentCategory]]);
            quizWords = allWords.slice(0, quizQuantity);
            quizScore = 0;
            document.getElementById('quiz-score').textContent = `â­ 0 / ${quizQuantity}`;
            document.getElementById('quiz-tabs').innerHTML = getCategories().map(c => 
                `<button class="category-tab ${c === currentCategory ? 'active' : ''}" onclick="switchQuizCategory('${c}')">${c}</button>`
            ).join('');
            
            // Update slider visibility and values
            const isLearningCategory = currentCategory.includes('K2ç¬¬äºŒæ®µä¸­æ–‡') || currentCategory.includes('K2ç¬¬äºŒæ®µè‹±æ–‡');
            document.getElementById('quantity-control').style.display = isLearningCategory ? 'block' : 'none';
            const availableWords = vocabulary[currentCategory].length;
            document.getElementById('quantity-slider').max = Math.min(20, availableWords);
            document.getElementById('quantity-display').textContent = `${quizQuantity} é¡Œ / å…± ${availableWords} é¡Œ`;
            
            renderQuiz();
        }
        
        function renderQuiz() {
            if (quizWords.length === 0) {
                document.getElementById('quiz-emoji').textContent = 'ğŸŠ';
                document.getElementById('quiz-prompt').textContent = 'å®Œæˆæ™’ï¼å‹å‘€ï¼â­â­â­';
                document.getElementById('quiz-options').innerHTML = '';
                setTimeout(() => initQuiz(), 3000);
                return;
            }
            
            const correct = quizWords.pop();
            let options = [correct];
            const others = vocabulary[currentCategory].filter(w => w !== correct);
            while (options.length < 4 && others.length > 0) {
                const idx = Math.floor(Math.random() * others.length);
                if (!options.includes(others[idx])) options.push(others[idx]);
            }
            options = shuffle(options);
            
            const isEnglish = currentCategory.includes('K2ç¬¬äºŒæ®µè‹±æ–‡');
            const isChineseLearning = currentCategory.includes('K2ç¬¬äºŒæ®µä¸­æ–‡');
            const emojiSize = (isEnglish || isChineseLearning) ? '1.2em' : '3em';
            
            if (isEnglish) {
                document.getElementById('quiz-emoji').innerHTML = `<span style="font-size:${emojiSize}">${correct.emoji}</span>`;
                document.getElementById('quiz-prompt').textContent = 'What is this?';
                document.getElementById('quiz-options').innerHTML = options.map(opt => 
                    `<button class="option-btn" onclick="checkAnswer(this, '${opt.english}', '${correct.english}')">${opt.english}</button>`
                ).join('') + 
                `<div style="text-align:center;margin-top:15px"><button class="quiz-speak-btn" onclick="speakText('${correct.english}', 'en')">ğŸ”Š è½è®€éŸ³</button></div>`;
            } else if (isChineseLearning) {
                document.getElementById('quiz-emoji').innerHTML = `<span style="font-size:${emojiSize}">${correct.emoji}</span>`;
                document.getElementById('quiz-prompt').textContent = 'å‘¢å€‹ä¿‚å’©å­—ï¼Ÿ';
                document.getElementById('quiz-options').innerHTML = options.map(opt => 
                    `<button class="option-btn" onclick="checkAnswer(this, '${opt.chinese}', '${correct.chinese}')">${opt.chinese}</button>`
                ).join('') + 
                `<div style="text-align:center;margin-top:15px"><button class="quiz-speak-btn" onclick="speakText('${correct.chinese}', 'zh-HK')">ğŸ”Š è½ç²µèª</button></div>`;
            }
        }
        
        function checkAnswer(btn, ans, correct) {
            if (ans === correct) {
                btn.classList.add('correct');
                quizScore++;
                const total = quizQuantity;
                const current = quizScore;
                document.getElementById('quiz-score').textContent = `â­ ${current} / ${total}`;
                const encourages = ['å‹å‘€ï¼ğŸ‰', 'å»å»çŒªï¼ğŸ·', 'å¥½å»å‘€ï¼â­'];
                document.getElementById('quiz-encourage').textContent = encourages[Math.floor(Math.random() * encourages.length)];
                setTimeout(renderQuiz, 1200);
            } else {
                btn.classList.add('wrong');
                const wrongMsg = ['åŠ æ²¹å‘€ï¼ğŸ’ª', 'å†è©¦å“ï¼ğŸ˜Š', 'å””ç·Šè¦ï¼ğŸ¤—'];
                document.getElementById('quiz-encourage').textContent = wrongMsg[Math.floor(Math.random() * wrongMsg.length)];
            }
        }
        
        // Matching
        function initMatching() {
            document.getElementById('match-tabs').innerHTML = getCategories().map(cat => 
                `<button class="category-tab ${cat === currentCategory ? 'active' : ''}" onclick="currentCategory='${cat}'; initMatching()">${cat}</button>`
            ).join('');
            
            const words = shuffle([...vocabulary[currentCategory]]).slice(0, 4);
            const pairs = [];
            const isEnglish = currentCategory.includes('K2ç¬¬äºŒæ®µè‹±æ–‡');
            
            words.forEach((w, i) => {
                const text = isEnglish ? w.english : w.chinese;
                const lang = isEnglish ? 'en' : 'zh-HK';
                
                // Text card
                pairs.push({ 
                    type: 'text', 
                    content: text, 
                    id: 'txt' + i, 
                    matchId: 'snd' + i,
                    lang: lang
                });
                // Audio card (ğŸ”Š)
                pairs.push({ 
                    type: 'audio', 
                    content: 'ğŸ”Š', 
                    id: 'snd' + i, 
                    matchId: 'txt' + i,
                    lang: lang
                });
            });
            
            const shuffled = shuffle(pairs);
            document.getElementById('match-score').textContent = 'â­ ' + matchScore;
            document.getElementById('match-grid').innerHTML = shuffled.map((p, idx) => {
                const bgColor = p.type === 'text' ? '#FF9A9E' : '#FFE66D';
                const fontSize = p.type === 'text' ? '1.5em' : '3em';
                return `<div class="matching-card" style="background:${bgColor};font-size:${fontSize}" 
                     data-id="${p.id}" data-mid="${p.matchId}" data-lang="${p.lang}" onclick="selectMatch(this)">
                     ${p.content}
                </div>`;
            }).join('');
        }
        
        function selectMatch(card) {
            // Play audio if it's an audio card
            if (card.textContent === 'ğŸ”Š') {
                const lang = card.dataset.lang;
                // Find the matching text card to get the word
                const textCardId = card.dataset.mid;
                const textCard = document.querySelector(`[data-id="${textCardId}"]`);
                if (textCard) {
                    speakMatchText(textCard.textContent, lang);
                }
            }
            
            if (card.classList.contains('matched')) return;
            if (!selectedMatch) {
                selectedMatch = card;
                card.classList.add('selected');
            } else {
                if (selectedMatch.dataset.id === card.dataset.id) {
                    selectedMatch.classList.remove('selected');
                    selectedMatch = null;
                } else if (selectedMatch.dataset.mid === card.dataset.id) {
                    card.classList.add('matched');
                    selectedMatch.classList.add('matched');
                    matchScore++;
                    document.getElementById('match-score').textContent = 'â­ ' + matchScore;
                    selectedMatch = null;
                    const remaining = document.querySelectorAll('.matching-card:not(.matched)');
                    if (remaining.length === 0) {
                        setTimeout(() => { alert('ğŸŠ å®Œæˆæ™’ï¼å‹å‘€ï¼â­â­â­'); matchScore = 0; initMatching(); }, 500);
                    }
                } else {
                    selectedMatch.classList.remove('selected');
                    selectedMatch = card;
                    card.classList.add('selected');
                }
            }
        }
        
        // Speak text for matching game
        function speakMatchText(text, lang) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.8;
                utterance.pitch = 1.1;
                window.speechSynthesis.speak(utterance);
            }
        }
        
        // Add word
        function addWord() {
            const cat = document.getElementById('add-category').value.trim();
            const w = document.getElementById('add-word').value.trim();
            const e = document.getElementById('add-emoji').value.trim();
            const en = document.getElementById('add-english').value.trim();
            if (!cat || !w || !e) {
                document.getElementById('add-result').innerHTML = 'âŒ è¦å¡«æ™’é¡åˆ¥ã€æ–‡å­—ã€Emojiï¼';
                return;
            }
            if (!vocabulary[cat]) vocabulary[cat] = [];
            vocabulary[cat].push({ chinese: w, emoji: e, english: en });
            document.getElementById('add-result').innerHTML = `âœ… åŠ å…¥æˆåŠŸï¼<br><div style="font-size:2em">${e}</div><div>${w} = ${en}</div>`;
            ['add-category','add-word','add-emoji','add-english'].forEach(id => document.getElementById(id).value = '');
        }
    </script>
</body>
</html>
